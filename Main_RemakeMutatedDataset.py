import MutantManager
import ConfigManager
import TestManager
import VariantComposer

from FileManager import get_project_dir, get_all_variant_dirs

if __name__ == "__main__":
    # ------ START CONFIG ------
    base_dir = "/data//spl_dataset"
    project_name = "4wise-AJStats-FH-JML"
    num_of_seeding_bugs = 1
    case_limit = 10000
    bug_ids = ["Advice.AspectJCollector.AORS_1","Advice.AspectJCollector.AOIU_1","Advice.AspectJCollector.ROR_1","Advice.Statistics.AOIS_1","Advice.Statistics.AOIS_5","AspectConstructors.AspectJCollector.AORS_1","AspectConstructors.AspectJCollector.AODU_2","AspectConstructors.AspectJCollector.AOIU_1","AspectConstructors.AspectJCollector.AOIU_2","AspectConstructors.AspectJCollector.AOIU_3","AspectConstructors.AspectJCollector.ODL_9","AspectConstructors.Statistics.AOIS_1","AspectConstructors.Statistics.AOIS_5","AspectFields.AspectJCollector.AORS_1","AspectFields.AspectJCollector.COD_1","AspectFields.Statistics.AOIS_1","AspectMethods.AspectJCollector.AORS_1","AspectMethods.AspectJCollector.AOIU_1","AspectMethods.AspectJCollector.ROR_1","AspectMethods.Statistics.AOIS_1","AspectMethods.Statistics.AOIS_5","Aspects.AspectJCollector.AORS_1","Aspects.AspectJCollector.AORS_2","Aspects.AspectJCollector.AORS_3","Aspects.AspectJCollector.AOIU_1","Aspects.Statistics.AOIS_1","Aspects.Statistics.AOIS_5","Aspects.Statistics.AOIS_9","Aspects.Statistics.AOIS_13","Base.AspectJCollector.AORS_1","Base.AspectJCollector.AOIU_1","Base.AspectJCollector.AOIU_2","Base.AspectJCollector.AOIU_5","Base.AspectJCollector.AOIS_7","Base.AspectJCollector.ROR_1","Base.AspectJCollector.ROR_8","Base.AspectJCollector.ROR_9","Base.AspectJCollector.ODL_8","Base.AspectJFileFilter.COR_1","Base.Statistics.AOIS_1","ClassConstructors.AspectJCollector.AORS_1","ClassConstructors.AspectJCollector.AODU_2","ClassConstructors.AspectJCollector.AOIU_1","ClassConstructors.AspectJCollector.AOIU_2","ClassConstructors.AspectJCollector.AOIU_3","ClassConstructors.AspectJCollector.ODL_9","ClassConstructors.Statistics.AOIS_1","ClassConstructors.Statistics.AOIS_5","ClassFields.AspectJCollector.AORS_1","ClassFields.AspectJCollector.COD_1","ClassFields.Statistics.AOIS_1","ClassMethods.AspectJCollector.AORS_1","ClassMethods.AspectJCollector.AOIU_1","ClassMethods.AspectJCollector.ROR_1","ClassMethods.Statistics.AOIS_1","ClassMethods.Statistics.AOIS_5","Classes.AspectJCollector.AORS_1","Classes.AspectJCollector.AORS_2","Classes.AspectJCollector.AORS_3","Classes.AspectJCollector.AOIU_1","Classes.Statistics.AOIS_1","Classes.Statistics.AOIS_5","Classes.Statistics.AOIS_9","Classes.Statistics.AOIS_13","CodeFormatter.CommentRemover.AORS_1","CodeFormatter.CommentRemover.AORS_2","CodeFormatter.CommentRemover.AORS_3","CodeFormatter.CommentRemover.AORS_4","CodeFormatter.CommentRemover.AODU_1","CodeFormatter.CommentRemover.AOIU_1","CodeFormatter.CommentRemover.AOIU_2","CodeFormatter.CommentRemover.AOIU_3","CodeFormatter.CommentRemover.AOIU_4","CodeFormatter.CommentRemover.AOIU_5","CodeFormatter.CommentRemover.AOIU_6","CodeFormatter.CommentRemover.AOIU_8","CodeFormatter.CommentRemover.AOIU_9","CodeFormatter.CommentRemover.AOIU_10","CodeFormatter.CommentRemover.AOIU_11","CodeFormatter.CommentRemover.AOIU_12","CodeFormatter.CommentRemover.AOIU_13","CodeFormatter.CommentRemover.AOIU_14","CodeFormatter.CommentRemover.AOIU_15","CodeFormatter.CommentRemover.AOIU_16","CodeFormatter.CommentRemover.AOIU_18","CodeFormatter.CommentRemover.AOIU_20","CodeFormatter.CommentRemover.AOIS_1","CodeFormatter.CommentRemover.AOIS_5","CodeFormatter.CommentRemover.AOIS_13","CodeFormatter.CommentRemover.AOIS_67","CodeFormatter.CommentRemover.ROR_71","CodeFormatter.CommentRemover.COR_1","CodeFormatter.CommentRemover.COD_3","CodeFormatter.CommentRemover.COD_4","CodeFormatter.CommentRemover.COI_11","CodeFormatter.CommentRemover.COI_14","CodeFormatter.CommentRemover.COI_17","CodeFormatter.CommentRemover.COI_18","CodeFormatter.CommentRemover.COI_19","CodeFormatter.CommentRemover.COI_21","CodeFormatter.CommentRemover.COI_23","CodeFormatter.CommentRemover.COI_24","CodeFormatter.CommentRemover.COI_25","CodeFormatter.CommentRemover.COI_27","CodeFormatter.CommentRemover.COI_28","CodeFormatter.CommentRemover.COI_29","CodeFormatter.CommentRemover.COI_30","CodeFormatter.CommentRemover.COI_31","CodeFormatter.CommentRemover.COI_32","InterTypeConstructors.AspectJCollector.AORS_1","InterTypeConstructors.AspectJCollector.AOIU_1","InterTypeConstructors.AspectJCollector.ROR_1","InterTypeConstructors.Statistics.AOIS_1","InterTypeConstructors.Statistics.AOIS_5","InterTypeDeclare.AspectJCollector.AORS_1","InterTypeDeclare.Statistics.AOIS_1","InterTypeFields.AspectJCollector.AORS_1","InterTypeFields.Statistics.AOIS_1","InterTypeMethods.AspectJCollector.AORS_1","InterTypeMethods.AspectJCollector.AOIU_1","InterTypeMethods.AspectJCollector.ROR_1","InterTypeMethods.Statistics.AOIS_1","InterTypeMethods.Statistics.AOIS_5","InterfaceFields.AspectJCollector.AORS_1","InterfaceFields.AspectJCollector.COD_1","InterfaceFields.Statistics.AOIS_1","InterfaceMethods.AspectJCollector.AORS_1","InterfaceMethods.Statistics.AOIS_1","Interfaces.AspectJCollector.AORS_1","Interfaces.AspectJCollector.AORS_2","Interfaces.AspectJCollector.AORS_3","Interfaces.AspectJCollector.AOIU_1","Interfaces.Statistics.AOIS_1","Interfaces.Statistics.AOIS_5","Interfaces.Statistics.AOIS_9","Interfaces.Statistics.AOIS_13","Pointcuts.AspectJCollector.AORS_1","Pointcuts.Statistics.AOIS_1","States.AspectJCollector.AORS_1","States.AspectJCollector.AORS_2","States.AspectJCollector.ROR_1","States.AspectJCollector.COI_1","States.AspectJCollector.COI_2","States.AspectJCollector.COI_3","States.AspectJCollector.COI_4","States.AspectJCollector.COI_5","States.AspectJCollector.COI_6","States.AspectJCollector.COI_7","States.AspectJCollector.COI_8","States.AspectJCollector.COI_11","States.AspectJCollector.COI_12","States.AspectJCollector.COI_13","States.AspectJCollector.COI_14","States.AspectJCollector.COI_15","States.AspectJCollector.COI_16","States.AspectJCollector.COI_17","States.AspectJCollector.COI_18","States.AspectJCollector.COI_19","States.AspectJCollector.COI_20","States.AspectJCollector.COI_21","States.AspectJCollector.COI_22","States.AspectJCollector.COI_23","States.AspectJCollector.COI_24","States.AspectJCollector.COI_25","States.AspectJCollector.COI_27","States.AspectJCollector.COI_29","States.AspectJCollector.COI_31","States.AspectJCollector.COI_33","States.AspectJCollector.COI_35"]
    # ------ END CONFIG ------

    project_dir = get_project_dir(project_name, base_dir)
    config_output_paths = ConfigManager.get_config_paths(project_dir, sort=True)
    variant_dirs = get_all_variant_dirs(project_dir, sort=True)

    # generate mutants and inject them to "optional" features
    mutated_project_dirs = MutantManager.regenerate_filtered_mutants(project_dir, bug_ids,
                                                                     num_of_bugs=num_of_seeding_bugs, case_limit=case_limit)

    # compile mutated feature's source code
    for mutated_project_dir in mutated_project_dirs:
        for config_path, variant_dir in zip(config_output_paths, variant_dirs):
            mutated_variant_dir = VariantComposer.compose_by_config(mutated_project_dir, config_path)
            TestManager.link_generated_junit_test_cases(variant_dir, mutated_variant_dir)

        ConfigManager.copy_configs_report(project_dir, mutated_project_dir)
