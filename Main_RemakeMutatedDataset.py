import MutantManager
import ConfigManager
import TestManager
import VariantComposer

from FileManager import get_project_dir, get_all_variant_dirs

if __name__ == "__main__":
    # ------ START CONFIG ------
    base_dir = "/data//spl_dataset"
    project_name = "4wise-ZipMe-FH-JML"
    num_of_seeding_bugs = 1
    case_limit = 10000
    # bug_ids = ["Adler32Checksum.net.sf.zipme.Inflater.AOIU_1","Adler32Checksum.net.sf.zipme.Inflater.ROR_1","Adler32Checksum.net.sf.zipme.Inflater.ODL_5","ArchiveCheck.net.sf.zipme.ZipArchive.AOIU_1","ArchiveCheck.net.sf.zipme.ZipArchive.COI_1","ArchiveCheck.net.sf.zipme.ZipArchive.SOR_1","Base.net.sf.zipme.CheckedInputStream.AOIU_1","Base.net.sf.zipme.CheckedInputStream.AOIU_4","Base.net.sf.zipme.CheckedInputStream.AOIU_5","Base.net.sf.zipme.CheckedInputStream.AOIU_7","Base.net.sf.zipme.CheckedInputStream.AOIU_11","Base.net.sf.zipme.CheckedInputStream.AOIU_13","Base.net.sf.zipme.CheckedInputStream.AOIU_21","Base.net.sf.zipme.CheckedInputStream.AOIU_22","Base.net.sf.zipme.CheckedOutputStream.AOIU_1","Base.net.sf.zipme.CheckedOutputStream.AOIU_3","Base.net.sf.zipme.CheckedOutputStream.AOIU_4","Base.net.sf.zipme.Deflater.AOIU_1","Base.net.sf.zipme.Deflater.AOIU_2","Base.net.sf.zipme.Deflater.AOIS_13","Base.net.sf.zipme.Deflater.COI_5","Base.net.sf.zipme.Deflater.AOIU_6","Base.net.sf.zipme.Deflater.AOIU_8","Base.net.sf.zipme.Deflater.AOIU_9","Base.net.sf.zipme.DeflaterOutputStream.AOIU_1","Base.net.sf.zipme.DeflaterPending.AOIU_1","Base.net.sf.zipme.InflaterDynHeader.AORS_1","Base.net.sf.zipme.InflaterDynHeader.AORS_2","Base.net.sf.zipme.InflaterDynHeader.AORS_3","Base.net.sf.zipme.InflaterDynHeader.AODS_3","Base.net.sf.zipme.InflaterDynHeader.AOIU_1","Base.net.sf.zipme.InflaterDynHeader.AOIU_2","Base.net.sf.zipme.InflaterDynHeader.AOIU_3","Base.net.sf.zipme.InflaterDynHeader.AOIU_4","Base.net.sf.zipme.InflaterDynHeader.AOIU_6","Base.net.sf.zipme.InflaterDynHeader.AOIU_8","Base.net.sf.zipme.InflaterDynHeader.AOIU_9","Base.net.sf.zipme.InflaterDynHeader.AOIU_11","Base.net.sf.zipme.InflaterDynHeader.AOIU_12","Base.net.sf.zipme.InflaterDynHeader.AOIU_14","Base.net.sf.zipme.InflaterDynHeader.AOIU_16","Base.net.sf.zipme.InflaterDynHeader.AOIU_18","Base.net.sf.zipme.InflaterDynHeader.AOIU_23","Base.net.sf.zipme.InflaterDynHeader.AOIU_27","Base.net.sf.zipme.InflaterDynHeader.AOIU_29","Base.net.sf.zipme.InflaterDynHeader.AOIU_30","Base.net.sf.zipme.InflaterDynHeader.AOIU_31","Base.net.sf.zipme.InflaterDynHeader.ROR_36","Base.net.sf.zipme.InflaterDynHeader.ASRS_1","Base.net.sf.zipme.InflaterDynHeader.ASRS_5","Base.net.sf.zipme.InflaterInputStream.AOIU_1","Base.net.sf.zipme.InflaterInputStream.ROR_1","Base.net.sf.zipme.InflaterInputStream.ROR_2","Base.net.sf.zipme.InflaterInputStream.ROR_11","Base.net.sf.zipme.InflaterInputStream.AOIU_3","Base.net.sf.zipme.InflaterInputStream.AOIU_4","Base.net.sf.zipme.InflaterInputStream.AODU_1","Base.net.sf.zipme.InflaterInputStream.AOIU_6","Base.net.sf.zipme.InflaterInputStream.LOR_1","Base.net.sf.zipme.InflaterInputStream.AOIU_9","Base.net.sf.zipme.InflaterInputStream.AOIU_11","Base.net.sf.zipme.InflaterInputStream.COR_1","Base.net.sf.zipme.InflaterInputStream.AOIU_13","Base.net.sf.zipme.InflaterInputStream.AOIU_16","Base.net.sf.zipme.InflaterInputStream.AOIU_19","Base.net.sf.zipme.InflaterInputStream.AOIU_23","Base.net.sf.zipme.OutputWindow.AORS_1","Base.net.sf.zipme.OutputWindow.AODS_2","Base.net.sf.zipme.OutputWindow.AOIU_5","Base.net.sf.zipme.OutputWindow.AORS_4","Base.net.sf.zipme.OutputWindow.AORS_7","Base.net.sf.zipme.OutputWindow.AOIU_8","Base.net.sf.zipme.OutputWindow.AOIU_10","Base.net.sf.zipme.OutputWindow.AOIU_13","Base.net.sf.zipme.OutputWindow.AOIS_33","Base.net.sf.zipme.OutputWindow.AOIS_51","Base.net.sf.zipme.OutputWindow.AOIU_25","Base.net.sf.zipme.OutputWindow.AOIU_27","Base.net.sf.zipme.OutputWindow.AOIU_34","Base.net.sf.zipme.OutputWindow.AOIU_39","Base.net.sf.zipme.OutputWindow.AOIS_195","Base.net.sf.zipme.OutputWindow.AOIU_49","Base.net.sf.zipme.OutputWindow.AOIU_54","Base.net.sf.zipme.StreamManipulator.AORS_1","Base.net.sf.zipme.StreamManipulator.AODU_1","Base.net.sf.zipme.StreamManipulator.AOIU_1","Base.net.sf.zipme.StreamManipulator.AOIU_3","Base.net.sf.zipme.StreamManipulator.AOIS_19","Base.net.sf.zipme.StreamManipulator.ASRS_3","Base.net.sf.zipme.StreamManipulator.AOIU_5","Base.net.sf.zipme.StreamManipulator.AOIU_8","Base.net.sf.zipme.StreamManipulator.AOIU_12","Base.net.sf.zipme.StreamManipulator.AOIS_59","Base.net.sf.zipme.StreamManipulator.LOD_1","Base.net.sf.zipme.StreamManipulator.AORS_7","Base.net.sf.zipme.StreamManipulator.AORS_8","Base.net.sf.zipme.StreamManipulator.AODS_3","Base.net.sf.zipme.StreamManipulator.AOIU_15","Base.net.sf.zipme.StreamManipulator.AOIU_18","Base.net.sf.zipme.StreamManipulator.AOIU_22","Base.net.sf.zipme.StreamManipulator.AOIS_127","Base.net.sf.zipme.StreamManipulator.ASRS_17","Base.net.sf.zipme.StreamManipulator.ASRS_19","Base.net.sf.zipme.StreamManipulator.AORS_12","Base.net.sf.zipme.StreamManipulator.AOIU_30","Base.net.sf.zipme.StreamManipulator.AOIU_32","Base.net.sf.zipme.StreamManipulator.AOIS_159","Base.net.sf.zipme.StreamManipulator.AOIS_179","Base.net.sf.zipme.StreamManipulator.ASRS_29","Base.net.sf.zipme.ZipArchive.AOIU_1","Base.net.sf.zipme.ZipArchive.AOIU_2","Base.net.sf.zipme.ZipArchive.AOIU_3","Base.net.sf.zipme.ZipArchive.AOIU_4","Base.net.sf.zipme.ZipArchive.AOIU_6","Base.net.sf.zipme.ZipArchive.AOIS_3","Base.net.sf.zipme.ZipArchive.AOIU_7","Base.net.sf.zipme.ZipArchive.ROR_29","Base.net.sf.zipme.ZipArchive.AORS_1","Base.net.sf.zipme.ZipArchive.AORS_4","Base.net.sf.zipme.ZipArchive.AOIU_12","Base.net.sf.zipme.ZipArchive.AOIU_16","Base.net.sf.zipme.ZipArchive.AOIU_20","Base.net.sf.zipme.ZipArchive.AOIU_21","Base.net.sf.zipme.ZipArchive.AOIU_22","Base.net.sf.zipme.ZipArchive.AOIU_23","Base.net.sf.zipme.ZipArchive.AOIU_25","Base.net.sf.zipme.ZipArchive.AOIU_27","Base.net.sf.zipme.ZipArchive.AOIS_77","Base.net.sf.zipme.ZipArchive.AOIS_113","Base.net.sf.zipme.ZipArchive.AOIS_117","Base.net.sf.zipme.ZipArchive.AOIS_121","Base.net.sf.zipme.ZipArchive.ROR_43","Base.net.sf.zipme.ZipArchive.ROR_45","Base.net.sf.zipme.ZipArchive.ROR_53","Base.net.sf.zipme.ZipArchive.ROR_68","Base.net.sf.zipme.ZipArchive.ROR_69","Base.net.sf.zipme.ZipArchive.ROR_70","Base.net.sf.zipme.ZipArchive.ODL_70","Base.net.sf.zipme.ZipArchive_InflaterInputStream.AOIU_1","Base.net.sf.zipme.ZipArchive_InflaterInputStream.ROR_8","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_1","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_3","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_4","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_6","Base.net.sf.zipme.ZipArchive_PartialInputStream.AORS_1","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIS_25","Base.net.sf.zipme.ZipArchive_PartialInputStream.AODS_4","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_13","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_15","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_18","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_21","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIS_103","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_22","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_23","Base.net.sf.zipme.ZipOutputStream.AOIU_1","Compress.net.sf.zipme.Deflater.ASRS_1","Compress.net.sf.zipme.Deflater.LOR_1","Compress.net.sf.zipme.Deflater.ROR_1","Compress.net.sf.zipme.Deflater.AOIU_1","Compress.net.sf.zipme.Deflater.AOIU_2","Compress.net.sf.zipme.Deflater.ROR_2","Compress.net.sf.zipme.Deflater.AOIU_4","Compress.net.sf.zipme.Deflater.AOIS_11","Compress.net.sf.zipme.Deflater.AOIU_8","Compress.net.sf.zipme.Deflater.AOIS_29","Compress.net.sf.zipme.Deflater.AOIU_9","Compress.net.sf.zipme.Deflater.AOIU_10","Compress.net.sf.zipme.Deflater.AOIU_12","Compress.net.sf.zipme.Deflater.ROR_8","Compress.net.sf.zipme.DeflaterOutputStream.AOIU_1","Compress.net.sf.zipme.DeflaterOutputStream.COD_1","Compress.net.sf.zipme.DeflaterOutputStream.COD_3","Compress.net.sf.zipme.DeflaterOutputStream.AOIU_5","Compress.net.sf.zipme.DeflaterOutputStream.AOIU_6","Compress.net.sf.zipme.DeflaterOutputStream.AOIU_7","DerivativeCompressAdler32Checksum.net.sf.zipme.DeflaterEngine.AOIU_1","DerivativeCompressAdler32Checksum.net.sf.zipme.DeflaterEngine.AOIU_2","DerivativeCompressAdler32Checksum.net.sf.zipme.DeflaterEngine.AOIU_4","DerivativeCompressGZIPCRC.net.sf.zipme.GZIPOutputStream.AOIU_1","DerivativeCompressGZIPCRC.net.sf.zipme.GZIPOutputStream_hook22.COI_1","DerivativeCompressGZIPCRC.net.sf.zipme.GZIPOutputStream_hook22.COI_2","DerivativeCompressGZIPCRC.net.sf.zipme.GZIPOutputStream_hook22.COI_3","DerivativeCompressGZIPCRC.net.sf.zipme.GZIPOutputStream_hook22.LOR_1","DerivativeExtractCRC.net.sf.zipme.ZipInputStream.ROR_1","DerivativeExtractCRC.net.sf.zipme.ZipInputStream.AOIU_1","DerivativeExtractCRC.net.sf.zipme.ZipInputStream.AOIU_2","DerivativeExtractCRC.net.sf.zipme.ZipInputStream.ROR_11","DerivativeGZIPCRC.net.sf.zipme.GZIPInputStream.AOIU_1","DerivativeGZIPCRC.net.sf.zipme.GZIPInputStream.AOIU_3","DerivativeGZIPCRC.net.sf.zipme.GZIPInputStream.AOIS_15","DerivativeGZIPCRC.net.sf.zipme.GZIPInputStream.AOIU_7","DerivativeGZIPCRC.net.sf.zipme.GZIPInputStream.AOIU_8","Extract.net.sf.zipme.ZipArchive.AOIU_1","Extract.net.sf.zipme.ZipArchive.AOIU_2","Extract.net.sf.zipme.ZipArchive.AOIU_3","Extract.net.sf.zipme.ZipArchive.AOIS_1","Extract.net.sf.zipme.ZipArchive.AOIS_17","Extract.net.sf.zipme.ZipArchive.ROR_1","Extract.net.sf.zipme.ZipArchive.ROR_2","Extract.net.sf.zipme.ZipArchive.ROR_3","Extract.net.sf.zipme.ZipArchive.ODL_7","Extract.net.sf.zipme.ZipInputStream.AOIU_1","Extract.net.sf.zipme.ZipInputStream.AODU_1","Extract.net.sf.zipme.ZipInputStream.AOIU_2","Extract.net.sf.zipme.ZipInputStream.AOIU_4","Extract.net.sf.zipme.ZipInputStream.AOIU_7","Extract.net.sf.zipme.ZipInputStream.AOIU_12","Extract.net.sf.zipme.ZipInputStream.AOIU_14","Extract.net.sf.zipme.ZipInputStream.AOIU_16","Extract.net.sf.zipme.ZipInputStream.AORS_1","Extract.net.sf.zipme.ZipInputStream.SOR_1","Extract.net.sf.zipme.ZipInputStream.SOR_3","Extract.net.sf.zipme.ZipInputStream.AOIU_21","Extract.net.sf.zipme.ZipInputStream.AOIU_25","Extract.net.sf.zipme.ZipInputStream.AOIU_26","Extract.net.sf.zipme.ZipInputStream.AOIU_27","Extract.net.sf.zipme.ZipInputStream.AOIU_28","Extract.net.sf.zipme.ZipInputStream.AOIS_93","Extract.net.sf.zipme.ZipInputStream.AOIS_97","Extract.net.sf.zipme.ZipInputStream.AOIS_113","Extract.net.sf.zipme.ZipInputStream.AOIS_117","Extract.net.sf.zipme.ZipInputStream.AOIS_121","Extract.net.sf.zipme.ZipInputStream.AOIS_125","Extract.net.sf.zipme.ZipInputStream.ROR_50","Extract.net.sf.zipme.ZipInputStream.COI_14","Extract.net.sf.zipme.ZipInputStream.AOIU_34","Extract.net.sf.zipme.ZipInputStream.LOR_15","Extract.net.sf.zipme.ZipInputStream.AOIU_36","Extract.net.sf.zipme.ZipInputStream.AOIU_39","Extract.net.sf.zipme.ZipInputStream.AOIS_181","Extract.net.sf.zipme.ZipInputStream.ROR_102","Extract.net.sf.zipme.ZipInputStream.ROR_111","Extract.net.sf.zipme.ZipInputStream.ASRS_13","Extract.net.sf.zipme.ZipInputStream.ROR_147","Extract.net.sf.zipme.ZipInputStream.LOR_25","Extract.net.sf.zipme.ZipInputStream.AOIS_257","Extract.net.sf.zipme.ZipInputStream.COD_1","Extract.net.sf.zipme.ZipInputStream.COI_41","GZIP.net.sf.zipme.GZIPInputStream.AOIU_1","GZIP.net.sf.zipme.GZIPInputStream.AODU_1","GZIP.net.sf.zipme.GZIPInputStream.AOIU_2","GZIP.net.sf.zipme.GZIPInputStream.AOIU_6","GZIP.net.sf.zipme.GZIPInputStream.COD_1","GZIP.net.sf.zipme.GZIPInputStream.COI_1","GZIP.net.sf.zipme.GZIPInputStream.AORS_1","GZIP.net.sf.zipme.GZIPInputStream.AOIU_7","GZIP.net.sf.zipme.GZIPInputStream.AOIU_11","GZIP.net.sf.zipme.GZIPInputStream.AOIU_12","GZIP.net.sf.zipme.GZIPInputStream.AOIU_14","GZIP.net.sf.zipme.GZIPInputStream.AOIU_17","GZIP.net.sf.zipme.GZIPInputStream.AOIU_22","GZIP.net.sf.zipme.GZIPInputStream.AOIU_23","GZIP.net.sf.zipme.GZIPInputStream.AOIU_34","GZIP.net.sf.zipme.GZIPInputStream.AOIU_35","GZIP.net.sf.zipme.GZIPInputStream.AOIS_43","GZIP.net.sf.zipme.GZIPInputStream.AOIS_75","GZIP.net.sf.zipme.GZIPInputStream.AOIS_155","GZIP.net.sf.zipme.GZIPInputStream.ROR_65","GZIP.net.sf.zipme.GZIPInputStream.ROR_114","GZIP.net.sf.zipme.GZIPInputStream.COI_30","GZIP.net.sf.zipme.GZIPInputStream.AOIU_37","GZIP.net.sf.zipme.GZIPInputStream.AOIU_38","GZIP.net.sf.zipme.GZIPInputStream.AOIU_40","GZIP.net.sf.zipme.GZIPInputStream.AOIU_42","GZIP.net.sf.zipme.GZIPInputStream.AOIU_45","GZIP.net.sf.zipme.GZIPInputStream.AOIS_173","GZIP.net.sf.zipme.GZIPInputStream.SOR_7","GZIP.net.sf.zipme.GZIPInputStream.SOR_13"]
    bug_ids = ["Adler32Checksum.net.sf.zipme.Inflater.AOIU_5","Adler32Checksum.net.sf.zipme.Inflater.ROR_2","Base.net.sf.zipme.Deflater.AOIU_3","Base.net.sf.zipme.InflaterDynHeader.AOIU_40","Base.net.sf.zipme.InflaterDynHeader.AOIU_42","Base.net.sf.zipme.InflaterInputStream.ROR_10","Base.net.sf.zipme.InflaterInputStream.AOIU_7","Base.net.sf.zipme.InflaterInputStream.AODU_2","Base.net.sf.zipme.OutputWindow.AORS_10","Base.net.sf.zipme.OutputWindow.AOIU_20","Base.net.sf.zipme.OutputWindow.AOIU_41","Base.net.sf.zipme.OutputWindow.AOIU_42","Base.net.sf.zipme.OutputWindow.AOIU_43","Base.net.sf.zipme.StreamManipulator.AOIU_7","Base.net.sf.zipme.StreamManipulator.AOIU_11","Base.net.sf.zipme.StreamManipulator.AOIU_13","Base.net.sf.zipme.ZipArchive_InflaterInputStream.AOIU_2","Base.net.sf.zipme.ZipArchive_PartialInputStream.AORS_2","Base.net.sf.zipme.ZipArchive_PartialInputStream.AOIU_16","Compress.net.sf.zipme.Deflater.AOIU_13","Compress.net.sf.zipme.Deflater.AOIU_15","Compress.net.sf.zipme.DeflaterOutputStream.AOIU_3","DerivativeExtractCRC.net.sf.zipme.ZipInputStream.ROR_2","DerivativeExtractCRC.net.sf.zipme.ZipInputStream.ROR_10","DerivativeGZIPCRC.net.sf.zipme.GZIPInputStream.AOIU_5","Extract.net.sf.zipme.ZipArchive.ODL_11","Extract.net.sf.zipme.ZipInputStream.AOIU_35","Extract.net.sf.zipme.ZipInputStream.COI_32","Extract.net.sf.zipme.ZipInputStream.AODU_2","Extract.net.sf.zipme.ZipInputStream.AODU_3","Extract.net.sf.zipme.ZipInputStream.COI_51"]
    # ------ END CONFIG ------

    project_dir = get_project_dir(project_name, base_dir)
    config_output_paths = ConfigManager.get_config_paths(project_dir, sort=True)
    variant_dirs = get_all_variant_dirs(project_dir, sort=True)

    # generate mutants and inject them to "optional" features
    mutated_project_dirs = MutantManager.regenerate_filtered_mutants(project_dir, bug_ids,
                                                                     num_of_bugs=num_of_seeding_bugs, case_limit=case_limit)

    # compile mutated feature's source code
    for mutated_project_dir in mutated_project_dirs:
        for config_path, variant_dir in zip(config_output_paths, variant_dirs):
            mutated_variant_dir = VariantComposer.compose_by_config(mutated_project_dir, config_path)
            TestManager.link_generated_junit_test_cases(variant_dir, mutated_variant_dir)

        ConfigManager.copy_configs_report(project_dir, mutated_project_dir)
